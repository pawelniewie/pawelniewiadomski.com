<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

  <meta property="og:title" content="Migrating rails project to Vue with Slim templates">

<meta property="og:type" content="article">

<meta property="og:url" content="https://pawelniewiadomski.com/2017/08/12/migrating-rails-project-to-vue-with-slim-templates/">

<meta property="og:image" content="https://pawelniewiadomski.com/media/2017/vue.png">

<meta property="og:description" content="">

<meta property="og:site_name" content="Pawel Niewiadomski">

<meta property="og:locale" content="en_US">


  <meta property="article:published_time" content="2017-08-12T00:00:00+00:00">
  <meta property="article:author" content="http://facebook.com/pawelniewie">
  
    <meta property="og:see_also" content="https://pawelniewiadomski.com/2017/09/11/rails-with-react-redux-form-and-semantic-ui/">
  
    <meta property="og:see_also" content="https://pawelniewiadomski.com/2017/02/27/graphql-intro-to-queries-mutations-authorization/">
  
    <meta property="og:see_also" content="https://pawelniewiadomski.com/2017/02/20/pitfalls-of-ruby-memoization-pattern/">
  


<meta property="fb:admins" content="http://facebook.com/pawelniewie">

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-1934760-4', 'auto');
  ga('send', 'pageview');
</script>
<script src="/public/jquery.scrolldepth.min.js"></script>
<script src="/public/screentime.min.js"></script>
<script src="/public/riveted.min.js"></script>
<script>
jQuery(function() {
  jQuery.scrollDepth();
  jQuery.screentime({
	  fields: [
	    { selector: '.masthead',
	      name: 'Master header'
	    },
	    { selector: '.container .post',
	      name: 'Post'
	    },
	    { selector: '.container .related',
	      name: 'Related'
	    }
	  ],
    googleAnalytics: true
	});
  riveted.init();
});
</script>
<script src="/public/hotjar.min.js"></script>
<script>
jQuery(function() {
	jQuery('#mce-NAME').on('change', function() {
		ga('send', 'event', 'Newsletter', 'Filled', 'First name');
	});

	jQuery('#mce-EMAIL').on('change', function() {
		ga('send', 'event', 'Newsletter', 'Filled', 'Email');
	});

	jQuery('#mc-embedded-subscribe').on('click', function() {
		ga('send', 'event', 'Newsletter', 'Clicked', 'Subscribe');
	});
});
</script>

  <title>
    
      Migrating rails project to Vue with Slim templates &middot; Pawel Niewiadomski
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="/public/css/font-awesome.min.css">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  <link rel="canonical" href="https://pawelniewiadomski.com/2017/08/12/migrating-rails-project-to-vue-with-slim-templates/">
</head>


  <body>
    <div class="container content">
  <small class="back">
    <strong>← <a href="https://pawelniewiadomski.com">back home</a></strong>
  </small>

  <article class="post">
    <h1 class="post-title">Migrating rails project to Vue with Slim templates</h1>
    
      <span class="post-date">12 Aug 2017</span>
    
    <p><img src="https://pawelniewiadomski.com/media/2017/vue-1966x924.png" width="572" srcset="https://pawelniewiadomski.com/media/2017/vue-1966x924.png 1x, https://pawelniewiadomski.com/media/2017/vue-1966x924.png 2x, https://pawelniewiadomski.com/media/2017/vue-1966x924.png 3x"></p>

<p><strong>Update 14th of August</strong> just found out that my setup was still broken, so I had to update but now supports template compilation as well!</p>

<p>Sometimes the most consuming part of the tasks is setting it up all together. Then coding is simple once all the puzzles fit it. So in the hope I can help someone having a similar problem I'm publishing a post on gluing Vue, Rails and Slim altogether.</p>

<p>I spent part of Friday setting up Vue in our Rails app. It's yet another framework we want to try out. We already have a homegrown framework, React, and now Vue. We're trying out Vue in the hope of giving us a decent framework that will be easier to integrate with the existing code.</p>

<p>Earlier this week were fun - I was playing with Vue for the first time. Just putting everything into a single slim file coding and trying to make it work (which I did). All the components had templates in one place, not a good approach for the future but I was focused on making it work, not making it clean and well structured.</p>

<p><a href="https://bearmetal.eu/team/tarmo/">Tarmo</a> prepared a nice branch with webpacker and Rails 5.1.3 so I decided to move my stuff there, to give it some proper structure (<code>vue</code> files) and finally use ES6 (still stuck in this project on CoffeeScript).</p>

<p>It was quite easy to start with <code>rails webpacker::install::vue</code>.  I started creating new <code>vue</code> files, splitting up my monolith to functional pieces.</p>

<p>But I got stuck with one and quite important thing for me - how to use existing <code>slim</code> templates? We use slim and I'm really found of it. Also having support on Vue side would be great - it would help us move existing stuff (and maybe share some parts?).</p>

<p>Finding slim support was quite easy, there's <a href="https://github.com/MaxPleaner/slim-lang-loader">slim-lang-loader</a> ♥️ <em>But then I had to <a href="https://github.com/GetSilverfin/slim-lang-loader">fix it</a> to create templates acceptable by <code>vue compiler</code></em></p>

<p>But how to use it in the vue file? I know you can add support for additional languages in <a href="https://vue-loader.vuejs.org/en/">vue-loader</a> and use syntax like (in <code>vue</code> file):</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>&lt;template lang="slim"&gt;
    div
        p
            This works!
&lt;/template&gt;
</code></pre></div>
<p>But I don't like this much, would prefer the view to be in a separate file (better IDE support, etc.).</p>

<p>So I tried to look up something on the net. Not much hints, except that simple <code>template: require('file')</code> should work provided I have proper loaders configured in the project.</p>

<p>But it didn't work out of the box. Was failing with:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>Module parse failed: .../node_modules/slim-lang-loader/index.js!.../app/javascript/packs/sky/filter-modal.slim Unexpected token (1:0)
You may need an appropriate loader to handle this file type.
| &lt;modal @close="hideModal"&gt;&lt;form class="sf-form sf-form-full sf-below-4 sf-pad-3" slot="body"&gt;&lt;div class="sf-grid sf-grid-fluid"&gt;&lt;slot name="form-body"&gt;&lt;/slot&gt;&lt;div class="sf-row"&gt;&lt;div class="sf-col sf-alignr"&gt;&lt;a :class="{ &amp;#39;sf-btn-disabled&amp;#39;: !canSave }" @click.prevent="$emit(&amp;#39;save&amp;#39;)" class="sf-btn sf-btn-success" href="#"&gt;Save&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/form&gt;&lt;/modal&gt;
| 
</code></pre></div>
<p>So part of it was working - rendering HTML from Slim! Yay! But I was still missing some loader, but which one?</p>

<p>I tried to come up with search keywords, trying <code>inline-loader</code>, <code>file-loader</code> and others. None worked. Finally I found the missing one <code>raw-loader</code> <em>but then found <code>vue-template-compiler-loader</code></em>!!!</p>

<p>So with a simple file <code>config/webpack/loaders/slim.js</code> <em>updated</em></p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">test</span><span class="o">:</span> <span class="sr">/.slim$/</span><span class="p">,</span>
  <span class="nx">loader</span><span class="o">:</span> <span class="p">[{</span>
    <span class="nx">loader</span><span class="o">:</span> <span class="s1">'vue-template-compiler-loader'</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="c1">// requires custom slim-lang-loader from </span>
    <span class="c1">// https://github.com/GetSilverfin/slim-lang-loader</span>
    <span class="nx">loader</span><span class="o">:</span> <span class="s1">'slim-lang-loader'</span><span class="p">,</span>
    <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">slimOptions</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">disable_escape</span><span class="o">:</span> <span class="kc">true</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}]</span>
<span class="p">}</span>
</code></pre></div>
<p>I made it work! <em>updated</em></p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span></span><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="kr">import</span> <span class="nx">Modal</span> <span class="nx">from</span> <span class="s1">'./modal'</span>

  <span class="kr">import</span> <span class="nx">template</span> <span class="nx">from</span> <span class="s1">'./filter-modal.slim'</span> 

  <span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
    <span class="nx">mixins</span><span class="o">:</span> <span class="p">[</span><span class="nx">template</span><span class="p">],</span>

    <span class="nx">props</span><span class="o">:</span> <span class="p">[</span><span class="s1">'hideModal'</span><span class="p">,</span> <span class="s1">'saveFilter'</span><span class="p">,</span> <span class="s1">'canSave'</span><span class="p">],</span>

    <span class="nx">components</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">modal</span><span class="o">:</span> <span class="nx">Modal</span><span class="p">,</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</code></pre></div>
<p>Well, there was one change needed as well, in <code>config/webpack/shared.js</code> I had to use vue version that supports runtime template compilation - <em>update no longer needed!!! (Rick voice on) Template precompilation!!! (Rick voice off)</em></p>

<p>Such a small change (in terms of the code) but such a big step forward! Now I can't wait to make something bigger with Vue.</p>

  </article>

  <footer>
    <div class="links">
      <a href="https://pawelniewiadomski.com/newsletter">Want to get on my list?</a>
    </div>
  </footer>
</div>

  </body>
</html>
