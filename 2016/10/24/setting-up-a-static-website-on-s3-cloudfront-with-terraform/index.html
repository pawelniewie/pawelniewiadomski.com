<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

  <meta property="og:title" content="Setting Up A Static Website On S3 Cloudfront With Terraform">

<meta property="og:type" content="website">

<meta property="og:url" content="https://pawelniewiadomski.com/2016/10/24/setting-up-a-static-website-on-s3-cloudfront-with-terraform/">

<meta property="og:image" content="https://pawelniewiadomski.com/media/avatar.jpg">

<meta property="og:description" content="">

<meta property="og:site_name" content="Pawel Niewiadomski">

<meta property="og:locale" content="en_US">


  <meta property="article:published_time" content="2016-10-24T00:00:00+00:00">
  <meta property="article:author" content="http://facebook.com/pawelniewie">
  


<meta property="fb:admins" content="http://facebook.com/pawelniewie">

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-1934760-4', 'auto');
  ga('send', 'pageview');
</script>
<script src="/public/jquery.scrolldepth.min.js"></script>
<script src="/public/screentime.min.js"></script>
<script src="/public/riveted.min.js"></script>
<script>
jQuery(function() {
  jQuery.scrollDepth();
  jQuery.screentime({
	  fields: [
	    { selector: '.masthead',
	      name: 'Master header'
	    },
	    { selector: '.container .post',
	      name: 'Post'
	    },
	    { selector: '.container .related',
	      name: 'Related'
	    }
	  ],
    googleAnalytics: true
	});
  riveted.init();
});
</script>
<script src="/public/hotjar.min.js"></script>
<script>
jQuery(function() {
	jQuery('#mce-NAME').on('change', function() {
		ga('send', 'event', 'Newsletter', 'Filled', 'First name');
	});

	jQuery('#mce-EMAIL').on('change', function() {
		ga('send', 'event', 'Newsletter', 'Filled', 'Email');
	});

	jQuery('#mc-embedded-subscribe').on('click', function() {
		ga('send', 'event', 'Newsletter', 'Clicked', 'Subscribe');
	});
});
</script>

  <title>
    
      Setting Up A Static Website On S3 Cloudfront With Terraform &middot; Pawel Niewiadomski
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="/public/css/font-awesome.min.css">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  <link rel="canonical" href="https://pawelniewiadomski.com/2016/10/24/setting-up-a-static-website-on-s3-cloudfront-with-terraform/">
</head>


  <body>
    <div class="container content">
  <small class="back">
    <strong>‚Üê <a href="https://pawelniewiadomski.com">back home</a></strong>
  </small>

  <article class="post">
    <h1 class="post-title">Setting Up A Static Website On S3 Cloudfront With Terraform</h1>
    
      <span class="post-date">24 Oct 2016</span>
    
    <p>I just spent couple of hours moving my blog to CloudFront. It would have been simpler if not Terraform but now I have this set up right I decided to save you some time.</p>

<p>This blog was hosted on S3 for a long time, but I always had nginx proxy in front that would take care of SSL. I was using <a href="https://letsencrypt.org">let&#39;s encrypt</a> for certificates. But after getting another email asking me to refresh the certificates I looked for an alternative.</p>

<p>Some time ago I was playing with the idea of moving everything to <a href="https://caddyserver.com">Caddy server</a>. Just to test it out as it has a built in support for let&#39;s encrypt, so I wouldn&#39;t have to deal with refreshing the certificates.</p>

<p>But I found a better way. I didn&#39;t know that before but <strong>AWS offers free, automatically refreshed SSL certificates for services you host with them</strong>. So instead of using let&#39;s encrypt with my own server I could switch to CloudFront and obtain a certificate from AWS. Thanks to that I wouldn&#39;t have to manage any server on my own <span title="Sweet">üç∞</span>!</p>

<h3>So what&#39;s Terraform anyway and why did I use it?</h3>

<p>I&#39;m really keen on the concept of having a configuration driven infrastructure and Terraform is a tool that lets achieve that. It supports AWS, DigitalOcean and others. It&#39;s popular and widely used.</p>

<h3>Making it work</h3>

<p>I had couple of issues trying to make Terraform work for me - first it was really hard to find how you can split everything into separate files. There are modules which you can use. But also you can just use separate files in the same directory and Terraform will concatenate them!</p>

<p>The other problem I had was I started with a one file that would try to set up services in different regions, and this is something Terraform currently struggles with. Lost some time trying to figure out why it is not working for me only to find <a href="https://github.com/hashicorp/terraform/issues/3454">this bug</a>. So I decided to have different regions in different and separate configurations.</p>

<p>Also while playing with Terraform I ended up creating two zones for <code>pawelniewiadomski.com</code> so I was hitting the wall with my head trying to understand why DNS doesn&#39;t get refreshed üò† It was a result of pulling out region specific configuration to a separate directory (with a new state).</p>

<p>In the end I managed to move the site and here&#39;s <a href="https://github.com/pawelniewie/infrastructure/tree/moving-blog-to-cloud-front/us-west-2">the configuration I used</a>.</p>

<p>To apply it just run </p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>terraform apply -var-file=../terraform.tfvars
</code></pre></div>
<p>You need to set up you AWS credentials first in <code>terraform.tfvars</code>:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">access_key</span> <span class="o">=</span> <span class="s2">&quot;XXX&quot;</span>
<span class="n">secret_key</span> <span class="o">=</span> <span class="s2">&quot;YYY&quot;</span>
</code></pre></div>
<p>PS</p>

<p>If you are interested I deploy the site to S3 using Wercker with <a href="https://github.com/pawelniewie/pawelniewiadomski.com/blob/master/wercker.yml">following configuration</a>. Continuous deployments FTW!</p>

<p>PPS</p>

<p>If you don&#39;t want to go through all the hops you an use <a href="https://pages.github.com">GitHub Pages</a> to host a static site as well.</p>

  </article>

  <footer>
    <div class="links">
      <a href="https://pawelniewiadomski.com/newsletter">Want to get on my list?</a>
    </div>
  </footer>
</div>

  </body>
</html>
